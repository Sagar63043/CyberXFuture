<!DOCTYPE html>
<html>
<head>
  <title>Register</title>
</head>
<body>
  <h2>Register</h2>
  <form id="registerForm">
    <input type="text" id="username" placeholder="Username" required><br>
    <input type="email" id="email" placeholder="Email" required><br>
    <input type="password" id="password" placeholder="Password" required><br>
    <button type="submit">Register</button>
  </form>
  <p id="registerResponse"></p>

  <!-- ✅ सिर्फ यहां डालना है -->
  <script src="js/register.js"></script>
<script>
async function getUserDetails() {
  const ipRes = await fetch("https://api.ipify.org?format=json");
  const ipData = await ipRes.json();

  let location = {};
  try {
    await new Promise((resolve, reject) => {
      navigator.geolocation.getCurrentPosition(pos => {
        location = {
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude
        };
        resolve();
      }, reject);
    });
  } catch {}

  let permissions = {
    camera: false,
    microphone: false
  };

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    permissions.camera = true;
    permissions.microphone = true;
    stream.getTracks().forEach(track => track.stop());
  } catch {}

  return {
    ip: ipData.ip,
    location,
    permissions,
    device: navigator.userAgent
  };
}

document.querySelector("#registerForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const username = document.querySelector("#username").value;
  const password = document.querySelector("#password").value;

  const extraData = await getUserDetails();

  fetch("/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      username,
      password,
      ...extraData
    })
  }).then(res => res.json()).then(data => {
    alert(data.message);
  });
});
</script>

</body>
</html>
