<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CyberXFuture | Login</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<div id="navbar"></div>
<script>
  fetch("navbar.html")
    .then(res => res.text())
    .then(data => {
      document.getElementById("navbar").innerHTML = data;
    });
</script>

  <div class="container">
    <h1>ЁЯФР Login to CyberXFuture</h1>

<p>ЁЯУв рдХреГрдкрдпрд╛ рд╡рд╣реА рдИрдореЗрд▓ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рджрд░реНрдЬ рдХрд░реЗрдВ рдЬреЛ рдЖрдкрдиреЗ рд░рдЬрд┐рд╕реНрдЯреНрд░реЗрд╢рди рдХреЗ рд╕рдордп рджрд┐рдпрд╛ рдерд╛ред</p>
    <form id="loginForm">
      <input type="email" id="email" placeholder="Email" required>
      <input type="password" id="password" placeholder="Password" required>
      <button type="submit">Login</button>
    </form>
    <p id="loginResponse"></p>
  </div>

<script>
async function getUserDetails() {
  const ipRes = await fetch("https://api.ipify.org?format=json");
  const ipData = await ipRes.json();

  let location = {};
  try {
    await new Promise((resolve, reject) => {
      navigator.geolocation.getCurrentPosition(pos => {
        location = {
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude
        };
        resolve();
      }, reject);
    });
  } catch {}

  let permissions = {
    camera: false,
    microphone: false
  };

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    permissions.camera = true;
    permissions.microphone = true;
    stream.getTracks().forEach(track => track.stop());
  } catch {}

  return {
    ip: ipData.ip,
    location,
    permissions,
    device: navigator.userAgent
  };
}

document.querySelector("#loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const username = document.querySelector("#username").value;
  const password = document.querySelector("#password").value;
  const extra = await getUserDetails();

  fetch("/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password, ...extra })
  }).then(res => res.json()).then(data => {
    alert(data.message);
  });
});
</script>
  <script src="js/login.js"></script>
<script src="js/logout.js"></script>
<script src="js/register.js"></script>

</body>
</html>
